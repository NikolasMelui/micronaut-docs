<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>11.1.2 Picocli Quick Start 1.0.0.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Micronaut
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/quickStart.html"><strong>2</strong><span>Quick Start</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/ioc.html"><strong>3</strong><span>Inversion of Control</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/config.html"><strong>4</strong><span>Application Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/aop.html"><strong>5</strong><span>Aspect Oriented Programming</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/httpServer.html"><strong>6</strong><span>The HTTP Server</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/httpClient.html"><strong>7</strong><span>The HTTP Client</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/cloud.html"><strong>8</strong><span>Cloud Native Features</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/serverlessFunctions.html"><strong>9</strong><span>Serverless Functions</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/messaging.html"><strong>10</strong><span>Message-Driven Microservices</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/commandLineApps.html"><strong>11</strong><span>Standalone Command Line Applications</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/configurations.html"><strong>12</strong><span>Configurations</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/languageSupport.html"><strong>13</strong><span>Language Support</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/management.html"><strong>14</strong><span>Management &amp; Monitoring</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/security.html"><strong>15</strong><span>Security</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/cli.html"><strong>16</strong><span>Micronaut CLI</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/appendix.html"><strong>17</strong><span>Appendices</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/messaging.html">&lt;&lt; <strong>10</strong><span>Message-Driven Microservices</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../../guide/configurations.html"><strong>12</strong><span>Configurations</span> >></a></div>
                


                <div class="project">
                    <h1>11.1.2 Picocli Quick Start</h1>

                    <p><strong>Version:</strong> 1.0.0.BUILD-SNAPSHOT</p>
                </div>

                

                

<h2 id="picocliQuickStart">11.1.2 Picocli Quick Start</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/commandLineApps/picocli/picocliQuickStart.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To add support for Picocli to an existing project, you should first add the picocli dependency and the Micronaut picocli configuration to your build configuration. For example in Gradle:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">info.picocli:picocli</span><span class="delimiter">&quot;</span></span>
compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:picocli</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or with Maven:</p>
</div>
<div class="listingblock">
<div class="title">Maven</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>info.picocli<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>picocli<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>io.micronaut.configuration<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>picocli<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_picocli">Configuring picocli</h3>
<div class="paragraph">
<p>Picocli does not require configuration. See other sections of the manual for configuring the services and resources to inject.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_picocli_command_with_command">Creating a Picocli Command with @Command</h3>
<div class="paragraph">
<p>This section will show a quick example that provides a command line interface to a HTTP client that communicates with the GitHub API.</p>
</div>
<div class="paragraph">
<p>When creating the project with the Micronaut CLI, use the <code>--profile=cli</code> profile, and also add the <code>--features=http-client</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; mn create-app my-cli-app --profile cli --features http-client example</pre>
</div>
</div>
<div class="paragraph">
<p>This will add the <code>io.micronaut:http-client</code> dependency to the build. You can also manually add this to your <code>gradle.build</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>compile "io.micronaut:http-client"</pre>
</div>
</div>
<div class="sect3">
<h4 id="_an_example_http_client">An Example HTTP Client</h4>
<div class="paragraph">
<p>To create a picocli <code>Command</code> you create a class with fields annotated with <code>@Option</code> or <code>@Parameters</code> to capture the values of the command line options or positional parameters, respectively.</p>
</div>
<div class="paragraph">
<p>Within the new project, you can now run the picocli-specific code generation commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; cd example
&gt; ../mn
mn&gt; create-command example.gitstar
| Rendered template Command.java to destination src/main/java/example/GitstarCommand.java
| Rendered template CommandTest.java to destination src/test/java/example/GitstarCommandTest.java</pre>
</div>
</div>
<div class="paragraph">
<p>For example the following is a picocli <code>@Command</code> that wraps around the GitHub API:</p>
</div>
<div class="listingblock">
<div class="title">Example picocli command with injected HTTP client</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.configuration.picocli.PicocliRunner</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.context.ApplicationContext</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation</span>.*;
<span class="keyword">import</span> <span class="include">io.micronaut.http.client</span>.*;
<span class="keyword">import</span> <span class="include">io.reactivex</span>.*;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">io.micronaut.http.HttpRequest</span>.*;

<span class="keyword">import</span> <span class="include">picocli.CommandLine</span>;
<span class="keyword">import</span> <span class="include">picocli.CommandLine.Command</span>;
<span class="keyword">import</span> <span class="include">picocli.CommandLine.Option</span>;
<span class="keyword">import</span> <span class="include">picocli.CommandLine.Parameters</span>;

<span class="keyword">import</span> <span class="include">java.util</span>.*;
<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;

<span class="annotation">@Command</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">gitstar</span><span class="delimiter">&quot;</span></span>, header = {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">@|green       _ _      _             |@</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="string"><span class="delimiter">&quot;</span><span class="content">@|green  __ _(_) |_ __| |_ __ _ _ _  |@</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">@|green / _` | |  _(_-&lt;  _/ _` | '_| |@</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">@|green </span><span class="char">\\</span><span class="content">__, |_|</span><span class="char">\\</span><span class="content">__/__/</span><span class="char">\\</span><span class="content">__</span><span class="char">\\</span><span class="content">__,_|_|   |@</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">@|green |___/                        |@</span><span class="delimiter">&quot;</span></span>},
        description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Shows GitHub stars for a project</span><span class="delimiter">&quot;</span></span>,
        mixinStandardHelpOptions = <span class="predefined-constant">true</span>, version = <span class="string"><span class="delimiter">&quot;</span><span class="content">gitstar 0.1</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">GitstarCommand</span> <span class="directive">implements</span> <span class="predefined-type">Runnable</span> {

    <span class="annotation">@Client</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://api.github.com</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Inject</span> RxHttpClient client; <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="annotation">@Option</span>(names = {<span class="string"><span class="delimiter">&quot;</span><span class="content">-v</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">--verbose</span><span class="delimiter">&quot;</span></span>}, description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Shows some project details</span><span class="delimiter">&quot;</span></span>)
    <span class="type">boolean</span> verbose;

    <span class="annotation">@Parameters</span>(description = {<span class="string"><span class="delimiter">&quot;</span><span class="content">One or more GitHub slugs (comma separated) to show stargazers for.</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">  Default: ${DEFAULT-VALUE}</span><span class="delimiter">&quot;</span></span>}, split = <span class="string"><span class="delimiter">&quot;</span><span class="content">,</span><span class="delimiter">&quot;</span></span>, paramLabel = <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;owner/repo&gt;</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; githubSlugs = <span class="predefined-type">Arrays</span>.asList(<span class="string"><span class="delimiter">&quot;</span><span class="content">micronaut-projects/micronaut-core</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">remkop/picocli</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">Exception</span> {
        PicocliRunner.run(GitstarCommand.class, args);
    }

    <span class="directive">public</span> <span class="type">void</span> run() { <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="keyword">for</span> (<span class="predefined-type">String</span> slug : githubSlugs) {
            <span class="predefined-type">Map</span> m = client.retrieve(
                    GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/repos/</span><span class="delimiter">&quot;</span></span> + slug).header(<span class="string"><span class="delimiter">&quot;</span><span class="content">User-Agent</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">remkop-picocli</span><span class="delimiter">&quot;</span></span>),
                    <span class="predefined-type">Map</span>.class).blockingFirst();
            <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">%s has %s stars%n</span><span class="delimiter">&quot;</span></span>, slug, m.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">watchers</span><span class="delimiter">&quot;</span></span>));

            <span class="keyword">if</span> (verbose) {
                <span class="predefined-type">String</span> msg = <span class="string"><span class="delimiter">&quot;</span><span class="content">Description: %s%nLicense: %s%nForks: %s%nOpen issues: %s%n%n</span><span class="delimiter">&quot;</span></span>;
                <span class="predefined-type">System</span>.out.printf(msg, m.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>),
                                ((<span class="predefined-type">Map</span>) m.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">license</span><span class="delimiter">&quot;</span></span>)).get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>),
                                m.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">forks</span><span class="delimiter">&quot;</span></span>), m.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">open_issues</span><span class="delimiter">&quot;</span></span>));
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Headers, footers and descriptions can be multi-line. You can embed ANSI styled text anywhere with the <code>@|STYLE1[,STYLE2]…​ text|@</code> <a href="https://picocli.info/#_usage_help_with_styles_and_colors">markup notation</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add version information to display when the user requests this with <code>--version</code>. This can also be supplied dynamically, e.g. from the <a href="https://github.com/remkop/picocli/blob/master/examples/src/main/java/picocli/examples/VersionProviderDemo2.java">manifest file</a> or a build-generated version <a href="https://github.com/remkop/picocli/blob/master/examples/src/main/java/picocli/examples/VersionProviderDemo1.java">properties file</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Inject a HTTP client. In this case, hard-coded to the GitHub API endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A positional parameter that lets the user select one or more GitHub projects</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The business logic: display information for each project the user requested.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The usage help message generated for this command looks like this:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../img/picocli-example.png" alt="picocli example"></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_subcommands">Subcommands</h3>
<div class="paragraph">
<p>If your service has a lot of functionality, a common pattern is to have subcommands to control different areas of the service.
To allow Micronaut to inject services and resources correctly into the subcommands,
make sure to obtain subcommand instances from the <code>ApplicationContext</code>, instead of instantiating them directly.</p>
</div>
<div class="paragraph">
<p>The easiest way to do this is to declare the subcommands on the top-level command, like this:</p>
</div>
<div class="listingblock">
<div class="title">A top-level command with subcommands</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Command</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">topcmd</span><span class="delimiter">&quot;</span></span>, subcommands = {SubCmd1.class, SubCmd2.class}) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">class</span> <span class="class">TopCommand</span> <span class="directive">implements</span> <span class="predefined-type">Callable</span>&lt;<span class="predefined-type">Object</span>&gt; { <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">Exception</span> {
        PicocliRunner.call(TopCommand.class, args); <i class="conum" data-value="3"></i><b>(3)</b>
    }
    <span class="comment">//...</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The top-level command has two subcommands, <code>SubCmd1</code> and <code>SubCmd2</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Let all commands in the hierarchy implement <code>Runnable</code> or <code>Callable</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Start the application with <code>PicocliRunner</code>. This creates an <code>ApplicationContext</code> that instantiates the commands and performs the dependency injection.</td>
</tr>
</table>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/messaging.html">&lt;&lt; <strong>10</strong><span>Message-Driven Microservices</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/configurations.html"><strong>12</strong><span>Configurations</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
